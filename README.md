**ä¸­æ–‡ç‰ˆä»‹ç»ï¼š** [è·³è½¬](#æ˜Ÿç€šå­¦å ‚)

**English intro:**  [GOTO](#Milky-Institute)

# æ˜Ÿç€šå­¦å ‚

## é¡¹ç›®ç®€ä»‹ï¼š

æ˜Ÿç€šå­¦å ‚æ˜¯ä¸€ä¸ªåŸºäºŽå¾®æœåŠ¡æž¶æž„çš„ç”Ÿäº§çº§åœ¨çº¿æ•™è‚²é¡¹ç›®ï¼Œé¢å‘æˆå¹´äººçš„éžå­¦åŽ†èŒä¸šæŠ€èƒ½åŸ¹è®­ã€‚åˆ†ä¸ºå­¦ç”Ÿç«¯å’Œç®¡ç†ç«¯ä¸¤éƒ¨åˆ†ã€‚é¡¹ç›®ä¸­ä¸»è¦åŒ…å«æœ‰å­¦ä¹ æœåŠ¡ã€ä¼˜æƒ åˆ¸æœåŠ¡ã€è¯¾ç¨‹æŽ¨èAI Agentç­‰ã€‚æ˜¯â€œå¤©æœºå­¦å ‚â€çš„è¿›ä¸€æ­¥å®žçŽ°å’Œæ”¹è¿›ç‰ˆã€‚æœ¬ä»“åº“ä¸ºåŽç«¯ä»“åº“

## æŠ€æœ¯æ ˆï¼š

SpringCloud Alibabaã€SSMã€Redis/Redissonã€RabbitMQã€Mysqlåˆ†åº“åˆ†è¡¨ã€XXL-Jobã€Spring AIç­‰

## é¡¹ç›®è´Ÿè´£ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

ðŸ†• å·²å®Œæˆï¼š

1. è´Ÿè´£å®žçŽ°å­¦ä¹ æœåŠ¡ï¼ŒåŸºäºŽRedisåˆå¹¶å†™è¯·æ±‚å’ŒDelayQueueå®žçŽ°æ–­ç‚¹ç»­æ’­åŠŸèƒ½ï¼Œä¼˜åŒ–é«˜å¹¶å‘çš„æ•°æ®åº“å†™ä¸šåŠ¡ï¼Œä½¿è¯¯å·®æŽ§åˆ¶åœ¨15ç§’å†…ã€‚
2. è´Ÿè´£ä¼˜æƒ åˆ¸ç®¡ç†åŠŸèƒ½ï¼Œå‘æ”¾ä¼˜æƒ åˆ¸æ—¶åˆ©ç”¨æŒ‰ä½åŠ æƒæ±‚å’Œç®—æ³•å’Œå¼‚æ­¥çº¿ç¨‹ç”Ÿæˆå…‘æ¢ç ï¼Œå¹¶åˆ©ç”¨BitMapéªŒè¯å…‘æ¢ç æ˜¯å¦å·²ç»å…‘æ¢ã€‚ä¿è¯äº†å…‘æ¢ç çš„å¯è¯»æ€§ã€ä¸å¯é‡å…‘ã€é˜²çˆ†åˆ·å’Œé«˜æ•ˆæ€§ã€‚
3. è´Ÿè´£ä¼˜æƒ åˆ¸çš„é¢†å–åŠŸèƒ½ï¼Œåˆ©ç”¨ä¹è§‚é”å’Œåˆ†å¸ƒå¼é”Redissonè§£å†³å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œè§£å†³äº‹åŠ¡è¾¹ç•ŒåŽŸå› å¯¼è‡´çš„é”å¤±æ•ˆé—®é¢˜ï¼Œé€šè¿‡aspectjåŠ¨æ€ä»£ç†è§£å†³äº‹åŠ¡å¤±æ•ˆé—®é¢˜ã€‚
4. è´Ÿè´£å®žçŽ°é€šç”¨åˆ†å¸ƒå¼é”çš„å°è£…ï¼ŒåŸºäºŽAOPã€è‡ªå®šä¹‰æ³¨è§£ã€å·¥åŽ‚æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼å®žçŽ°ã€‚
5. è´Ÿè´£ä¼˜æƒ åˆ¸çš„ä½¿ç”¨ï¼Œé€šè¿‡æŸ¥è¯¢æ‰€æœ‰å¯ç”¨ä¼˜æƒ åˆ¸ï¼Œç»è¿‡åˆç­›ã€ç»†ç­›ã€æŽ’åˆ—ç»„åˆè®¡ç®—å‡ºæ‰€æœ‰å¯ç”¨ä¼˜æƒ åˆ¸ç»„åˆï¼Œå¹¶åŸºäºŽCompleteableFutureå¹¶è¡Œè®¡ç®—æ¯ç§ç»„åˆçš„ä¼˜æƒ æ˜Žç»†ï¼Œæœ€åŽæŒ‰ç…§è§„åˆ™ç­›é€‰å‡ºæœ€ä¼˜è§£ã€‚



â³ å¼€å‘è®¡åˆ’

1. è®¾è®¡å¹¶å®žçŽ°é—®ç­”è¯„è®ºæ¨¡å—ï¼Œæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„åŒ¿åä¸Žå¦ï¼Œè®°å½•é—®ç­”æˆ–è€…è¯„è®ºä¿¡æ¯ï¼Œå¹¶äº§ç”Ÿå¯¹åº”çš„ç§¯åˆ†ï¼Œé€šè¿‡RabbitMQæŽ¨é€ç»™ç§¯åˆ†ç³»ç»Ÿã€‚
2. ç‚¹èµžæœåŠ¡çš„æ­å»ºä¸Žå®žçŽ°ï¼Œç”¨æˆ·å‰ç«¯å‘é€ç‚¹èµžè¯·æ±‚åˆ°è¾¾ç‚¹èµžæœåŠ¡ï¼Œç‚¹èµžæœåŠ¡è´Ÿè´£å­˜å‚¨ç‚¹èµžè®°å½•ä¸Žç‚¹èµžæ•°é‡ï¼Œå¹¶é€šè¿‡å®šæ—¶ä»»åŠ¡å‘é€MQæ¶ˆæ¯é€šçŸ¥ä¸šåŠ¡æ–¹æ›´æ–°ç‚¹èµžæ•°é‡ã€‚
3. ç­¾åˆ°åŠŸèƒ½å®žçŽ°ä¸Žä¼˜åŒ–ï¼ŒåŸºäºŽBitMapæ•°æ®ç»“æž„å­˜å‚¨ç­¾åˆ°è®°å½•ï¼Œé€šè¿‡MQæŽ¨é€ç­¾åˆ°ä¿¡æ¯åŠç§¯åˆ†åˆ°ç§¯åˆ†æœåŠ¡ã€‚
4. ç§¯åˆ†æŽ’è¡Œæ¦œåŠŸèƒ½å®žçŽ°ï¼Œåˆ©ç”¨Redisçš„Zsetå­˜å‚¨æœ¬æœˆå®žæ—¶æŽ’è¡Œæ¦œæ•°æ®ã€‚é€šè¿‡XXL-Jobåˆ†ç‰‡ä»»åŠ¡æŒä¹…åŒ–åŽ†å²æ¦œå•åˆ°Mysqlæ•°æ®åº“ä¸­ï¼ŒMysqlé‡‡ç”¨çš„æ˜¯åˆ†åº“åˆ†è¡¨ï¼Œåˆ©ç”¨MybatisPlusçš„åŠ¨æ€è¡¨åæ¥è®¡ç®—è¡¨åã€‚
5. å®Œæˆlangchainæ™ºèƒ½ä½“æ¨¡å—ã€‚

## é¡¹ç›®è¿›åº¦

åŸºäºŽâ€œå¤©æœºå­¦å ‚â€åŸºç¡€ç‰ˆæœ¬ï¼Œä¸€äº›åŠŸèƒ½æ²¡åš

ç›¸å…³å¾®æœåŠ¡åŠ1.0.0ç‰ˆæœ¬çš„å®ŒæˆçŠ¶æ€å¦‚ä¸‹ï¼š

| å¾®æœåŠ¡åç§°   | åŠŸèƒ½æè¿° | å®ŒæˆçŠ¶æ€        |
| ------------ | -------- | --------------- |
| tj-parent    | çˆ¶å·¥ç¨‹   | âœ… å·²å®Œæˆ        |
| tj-api    | feignæŠ½å– | ðŸ†•å·²å®Œæˆï¼ˆå®Œå–„ï¼‰ |
| tj-common    | é€šç”¨å·¥ç¨‹ | ðŸ†•å·²å®Œæˆï¼ˆå®Œå–„ï¼‰ |
| tj-message   | æ¶ˆæ¯ä¸­å¿ƒ | âœ… å·²å®Œæˆ        |
| tj-gateway   | ç½‘å…³     | ðŸ†•å·²å®Œæˆï¼ˆå®Œå–„ï¼‰ |
| tj-auth      | æƒé™æœåŠ¡ | ðŸ†•å·²å®Œæˆï¼ˆå®Œå–„ï¼‰ |
| tj-user      | ç”¨æˆ·æœåŠ¡ | âœ… å·²å®Œæˆ        |
| tj-pay       | æ”¯ä»˜æœåŠ¡ | âœ… å·²å®Œæˆ        |
| tj-course    | è¯¾ç¨‹æœåŠ¡ | ðŸ†•å·²å®Œæˆï¼ˆå®Œå–„ï¼‰ |
| tj-exam      | è€ƒè¯•æœåŠ¡ | â³ å¼€å‘ä¸­        |
| tj-search    | æœç´¢æœåŠ¡ | âœ… å·²å®Œæˆ        |
| tj-trade     | äº¤æ˜“æœåŠ¡ | ðŸ†•å·²å®Œæˆï¼ˆå®Œå–„ï¼‰ |
| tj-learning  | å­¦ä¹ æœåŠ¡ | ðŸ†•å·²å®Œæˆï¼ˆæ–°å¢žï¼‰ |
| tj-promotion | ä¿ƒé”€æœåŠ¡ | ðŸ†•å·²å®Œæˆï¼ˆæ–°å¢žï¼‰ |
| tj-media     | åª’èµ„æœåŠ¡ | âœ… å·²å®Œæˆ        |
| tj-data      | æ•°æ®æœåŠ¡ | â³ å¼€å‘ä¸­        |
| tj-remark    | è¯„ä»·æœåŠ¡ | â³ å¼€å‘ä¸­        |
| tj-agent    | langchainæ™ºèƒ½ä½“ | â³ å¼€å‘ä¸­       |


## é¡¹ç›®åŸŸååˆ—è¡¨

| åç§°             | åŸŸå               | è´¦å·å¯†ç      | ç«¯å£  |
| ---------------- | ------------------ | ------------ | ----- |
| Gitç§æœ          | git.tianji.com     | tjxt/123321  | 10880 |
| JenkinsæŒç»­é›†æˆ  | jenkins.tianji.com | root/123     | 18080 |
| RabbitMQ         | mq.tianji.com      | tjxt/123321  | 15672 |
| NacosæŽ§åˆ¶å°      | nacos.tianji.com   | nacos/nacos  | 8848  |
| xxl-jobæŽ§åˆ¶å°    | xxljob.tianji.com  | admin/123456 | 8880  |
| ESçš„KibanaæŽ§åˆ¶å° | es.tianji.com      | -            | 5601  |
| å¾®æœåŠ¡ç½‘å…³       | api.tianji.com     | -            | 10010 |
| ç”¨æˆ·ç«¯å…¥å£       | www.tianji.com     | -            | 18081 |
| ç®¡ç†ç«¯å…¥å£       | manage.tianji.com  | -            |       |

## é¡¹ç›®è¿ç»´æµç¨‹

æäº¤ä»£ç åˆ°gogs-->é€šçŸ¥jenkins-->jenkinsæ‹‰å–ä»£ç -->è‡ªåŠ¨æž„å»º-->è‡ªåŠ¨éƒ¨ç½²-->è‡ªåŠ¨æµ‹è¯•ï¼ˆåŸºäºŽè„šæœ¬ï¼‰



# Milky Institute

## Project Overview:

Milky Institute is a production-grade online education project built on a microservice architecture, focusing on non-academic vocational skills training for adults. It consists of two parts: the student portal and the admin portal. Key services within the project include Learning Service, Coupon Service, and Lesson Recommendation AI Agent. This project is an improved implementation of "Tianji Academy". This repository contains the backend codebase.

## Tech Stack:

SpringCloud, SSM, Redis/Redisson, RabbitMQ, MySQL (sharding by database and table), XXL-Job, Spring AI etc.

## Project Responsibilities (Core Features)

ðŸ†• **Completed:**

1. Implemented the Learning Service, achieving resume-play functionality using Redis-based write request merging and DelayQueue. Optimized high-concurrency database write operations, controlling errors within 15 seconds.
2. Developed Coupon Management functionality: generated redemption codes using bitwise weighted sum algorithm and asynchronous threads during coupon distribution, and validated redemption status via BitMap. Ensured readability, non-redeemability, anti-brute-force protection, and high efficiency of redemption codes.
3. Built Coupon Collection functionality: resolved concurrency security issues using optimistic locking and Redisson distributed locks, fixed lock invalidation caused by transaction boundary issues, and addressed transaction failure via AspectJ dynamic proxy.
4. Implemented encapsulation of generic distributed locks based on AOP, custom annotations, Factory Pattern, and Strategy Pattern.
5. Developed Coupon Usage functionality: queried all available coupons, performed preliminary screening, detailed screening, and permutation-combination calculations to generate all valid coupon combinations. Calculated discount details for each combination in parallel using CompletableFuture, and finally filtered out the optimal solution according to predefined rules.

â³ **Development Plan**

1. Design and implement the Q&A and Comment Module: record Q&A/comment information based on user-selected anonymity settings, generate corresponding points, and push data to the Points System via RabbitMQ.
2. Build and implement the Like Service: receive like requests from the frontend, store like records and counts, and send MQ messages via scheduled tasks to notify business parties of like count updates.
3. Implement and optimize the Check-in Function: store check-in records using BitMap data structure, and push check-in information and points to the Points Service via MQ.
4. Develop Points Ranking functionality: store real-time monthly ranking data using Redis Zset. Persist historical rankings to MySQL (with database and table sharding) via XXL-Job sharding tasks, calculating table names using MybatisPlus dynamic table name feature.
5. Complete the LangChain Agent Module.

## Project Progress

Based on the basic version of "Sky Academy", some features are yet to be implemented.

Completion status is as follows:

| Microservice Name |  Function Description  |   Completion Status    |
| :---------------: | :--------------------: | :--------------------: |
|     tj-parent     |     Parent Project     |      âœ… Completed       |
|      tj-api       |    Feign Extraction    | ðŸ†• Completed (Improved) |
|     tj-common     |     Common Project     | ðŸ†• Completed (Improved) |
|    tj-message     |     Message Center     |      âœ… Completed       |
|    tj-gateway     |        Gateway         | ðŸ†• Completed (Improved) |
|      tj-auth      | Authentication Service | ðŸ†• Completed (Improved) |
|      tj-user      |      User Service      |      âœ… Completed       |
|      tj-pay       |    Payment Service     |      âœ… Completed       |
|     tj-course     |     Course Service     | ðŸ†• Completed (Improved) |
|      tj-exam      |      Exam Service      |    â³ In Development    |
|     tj-search     |     Search Service     |      âœ… Completed       |
|     tj-trade      |    Trading Service     | ðŸ†• Completed (Improved) |
|    tj-learning    |    Learning Service    |   ðŸ†• Completed (New)    |
|   tj-promotion    |   Promotion Service    |   ðŸ†• Completed (New)    |
|     tj-media      |     Media Service      |      âœ… Completed       |
|      tj-data      |      Data Service      |    â³ In Development    |
|     tj-remark     |     Review Service     |    â³ In Development    |
|     tj-agent      |    LangChain Agent     |    â³ In Development    |

## Project Domain List

|         Name         |                      Domain                      | Account & Password | Port  |
| :------------------: | :----------------------------------------------: | :----------------: | :---: |
|  Git Private Server  |     [git.tianji.com](https://git.tianji.com)     |    tjxt/123321     | 10880 |
|      Jenkins CI      | [jenkins.tianji.com](https://jenkins.tianji.com) |      root/123      | 18080 |
|       RabbitMQ       |      [mq.tianji.com](https://mq.tianji.com)      |    tjxt/123321     | 15672 |
|    Nacos Console     |   [nacos.tianji.com](https://nacos.tianji.com)   |    nacos/nacos     | 8848  |
|   XXL-Job Console    |  [xxljob.tianji.com](https://xxljob.tianji.com)  |    admin/123456    | 8880  |
|  ES Kibana Console   |      [es.tianji.com](https://es.tianji.com)      |         -          | 5601  |
| Microservice Gateway |     [api.tianji.com](https://api.tianji.com)     |         -          | 10010 |
|    Student Portal    |     [www.tianji.com](https://www.tianji.com)     |         -          | 18081 |
|     Admin Portal     |  [manage.tianji.com](https://manage.tianji.com)  |         -          |       |

## Project Operation & Maintenance Process

Submit code to Gogs --> Notify Jenkins --> Jenkins pulls code --> Automatic build --> Automatic deployment --> Automatic testing (script-based)

